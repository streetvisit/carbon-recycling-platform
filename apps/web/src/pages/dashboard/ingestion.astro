---
import DashboardLayout from '../../layouts/DashboardLayout.astro';
import DataSourceList from '../../components/DataSourceList.tsx';
import AddDataSourceModal from '../../components/AddDataSourceModal.tsx';
// Auth temporarily disabled for static build
// Will be re-enabled in production with proper configuration
---

<DashboardLayout 
  title="Data Ingestion Hub" 
  description="Connect and manage your carbon data sources"
  currentPage="ingestion"
>
  <div class="space-y-8">
    <!-- Action Button -->
    <div class="flex justify-end">
      <button 
        id="add-datasource-btn"
        class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors"
      >
        <svg class="-ml-1 mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
        </svg>
        Add New Data Source
      </button>
    </div>

    <!-- Data Sources List -->
    <DataSourceList client:load />
  </div>

  <!-- Add Data Source Modal -->
  <div id="modal-container">
    <!-- Modal will be rendered here by client-side JavaScript -->
  </div>

  <script>
    // Handle add data source button
    document.addEventListener('DOMContentLoaded', () => {
      const addBtn = document.getElementById('add-datasource-btn');
      let modalOpen = false;
      
      addBtn?.addEventListener('click', () => {
        if (!modalOpen) {
          // Create and render modal component
          modalOpen = true;
          // This would typically be handled by a state management solution
          console.log('Opening add data source modal');
          // For now, just show an alert - the actual modal integration would happen client-side
          alert('Add Data Source modal would open here - this will be properly integrated with the component.');
          modalOpen = false;
        }
      });
    });
  </script>
</DashboardLayout>
