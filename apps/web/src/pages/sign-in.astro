---
import Layout from '../layouts/Layout.astro';
import { PUBLIC_CLERK_PUBLISHABLE_KEY } from 'astro:env/client';
---

<Layout title="Sign In - Carbon Recycling Platform">
  <main class="min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8">
    <div class="sm:mx-auto sm:w-full sm:max-w-md">
      <div class="text-center">
        <h2 class="text-3xl font-bold text-gray-900">
          Carbon Recycling Platform
        </h2>
        <p class="mt-2 text-sm text-gray-600">
          Sign in to your account
        </p>
      </div>
    </div>

    <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
      <div class="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
        <!-- Clerk SignIn component will be inserted here -->
        <div id="sign-in"></div>
      </div>
    </div>
  </main>

  <script define:vars={{ clerkPublishableKey: PUBLIC_CLERK_PUBLISHABLE_KEY }}>
    import { Clerk } from '@clerk/clerk-js';
    
    // Initialize Clerk with environment variable
    if (clerkPublishableKey) {
      const clerk = new Clerk(clerkPublishableKey);
      clerk.load().then(() => {
        clerk.mountSignIn(document.getElementById('sign-in'), {
          signUpUrl: '/sign-up',
          fallbackRedirectUrl: '/dashboard',
        });
      }).catch((error) => {
        console.error('Failed to initialize Clerk:', error);
        document.getElementById('sign-in').innerHTML = 
          '<div class="text-red-600 text-center p-4">Failed to load authentication. Please check your Clerk configuration.</div>';
      });
    } else {
      console.error('Clerk publishable key not found');
      document.getElementById('sign-in').innerHTML = 
        '<div class="text-red-600 text-center p-4">Authentication not configured. Please add CLERK_PUBLISHABLE_KEY environment variable.</div>';
    }
  </script>
</Layout>